#include "videoram.h"

uint8_t vram[2][VIDEORAMSIZE] __attribute__ ((section (".sram1")));

uint8_t frameStart = 0;
uint8_t activeBuffer = 0;

uint8_t realvram[REALVIDEORAMSIZE] = {
		0b00,	0x1f,	0x1f,	0x00,	0x00,	0x1f,	0x1f,	0x00,
		0x1F,	0xD2,	0xD5,	0x45,	0x42,	0xCE,	0xD1,	0x1f,
		0xA1,	0xD5,	0xD5,	0xD9,	0xD7,	0xD5,	0xD5,	0xB8,
		0x9C,	0xD5,	0xD5,	0xD5,	0xD5,	0xD5,	0xD5,	0xB6,
		0x41,	0xD9,	0xD5,	0xD5,	0xD5,	0xD5,	0xD7,	0x5F,
		0x00,	0x5B,	0xD6,	0xD5,	0xD5,	0xD9,	0x74,	0x00,
		0x00,	0x00,	0x2A,	0xB1,	0xBC,	0x38,	0x00,	0x00,
		0x00,	0x00,	0x00,	0x59,	0x59,	0x00,	0x00,	0x00,
		0b00,	0x1f,	0x1f,	0x00,	0x00,	0x1f,	0x1f,	0x00,
		0x1F,	0xD2,	0xD5,	0x45,	0x42,	0xCE,	0xD1,	0x1f,
		0xA1,	0xD5,	0xD5,	0xD9,	0xD7,	0xD5,	0xD5,	0xB8,
		0x9C,	0xD5,	0xD5,	0xD5,	0xD5,	0xD5,	0xD5,	0xB6,
		0x41,	0xD9,	0xD5,	0xD5,	0xD5,	0xD5,	0xD7,	0x5F,
		0x00,	0x5B,	0xD6,	0xD5,	0xD5,	0xD9,	0x74,	0x00,
		0x00,	0x00,	0x2A,	0xB1,	0xBC,	0x38,	0x00,	0x00,
		0x00,	0x00,	0x00,	0x59,	0x59,	0x00,	0x00,	0x00
};

void convertPixel(uint8_t *target, uint16_t x, uint8_t y, uint8_t c) {
	target[x * 12]     = (c & 0b10000000) >> 7;
	target[x * 12 + 1] = (c & 0b1000000) >> 6;
	target[x * 12 + 2] = (c & 0b100000) >> 5;
	target[x * 12 + 3] = (c & 0b10000) >> 4;
	target[x * 12 + 4] = (c & 0b1000) >> 3;
	target[x * 12 + 5] = (c & 0b100) >> 2;
	target[x * 12 + 6] = (c & 0b10) >> 1;
	target[x * 12 + 7] = c & 0b1;
}

void convertFrame() {
	for (int i = 0; i < REALVIDEORAMSIZE; i++) {
		convertPixel(vram[activeBuffer ^ 1], i, 0, realvram[i]);
	}
}
